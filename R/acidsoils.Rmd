---
title: "Estimating acid soil distribution in cropland at the continental scale."
author: "Sebastian Palmas"
date: "2019-07-010"
output: pdf_document
---

# Acid soils

With the help of [Google Earth Engine (GEE)](https://earthengine.google.com/) we can analyze any continental spatial data in seconds.

This code below estiamtes the amount of cropland with an estimated high acidity (pH < 5.6). It then summarises the results by country.

* We are using USGS-NASA cropland mask. We plan to update it to the [Copernicus Global Land Cover](http://lcviewer.vito.be/).
* We use africasoils pH prediction for the continent.
```{r packages, message=FALSE}
library(ggplot2)
library(tidyverse)
```

```{r reading, message=FALSE}
  
crop <- jsonlite::fromJSON('../Data/croparea_bycountry.geojson' )
crop <- crop$features$properties %>% 
  mutate(croparea_km = sum/100/1000000) %>% # dividedby 100 because scale of copernicus was 0-100 (percentage, not proportion) #/1000000 from m2 to km2
  select(country_co, croparea_km) 

acidcrop <- jsonlite::fromJSON('../Data/acidcroparea_bycountry.geojson' )
acidcrop <- acidcrop$features$properties %>% 
  select(country_co, sum) %>% 
  full_join(crop, by = 'country_co') %>% 
  mutate(acidcroparea_km = sum/100/1000000,
         acidcroparea_crop = acidcroparea_km / croparea_km) %>%   # to vonvert to km2
  select(-sum)


head(acidcrop)
```

## 12 Countries with the highest estimated cropland area under acid soils 

```{r plot1, echo = FALSE, message=FALSE}
p2 <- ggplot(acidsoils %>% filter(count > 5000), aes(x = reorder(abbreviati, -acid_cropland), y = acid_cropland)) +
  geom_bar(stat = "identity") +
  ylab('Cropland area with high acidity (km2)') +
  theme(axis.text.x = element_text(angle = 90))+
  xlab('Country')
p2
```

## Percentage of country cropland under high acidiry
```{r perc, echo = FALSE}
p2 <- ggplot(acidsoils %>% filter(perc_acid_cropland > .1), aes(x = reorder(abbreviati, -perc_acid_cropland), y = perc_acid_cropland)) +
  geom_bar(stat = "identity") +
  scale_y_continuous(labels = scales::percent) +
  theme(axis.text.x = element_text(angle = 90))+
  ylab('Percertage of country cropland high acidity (%)') + xlab('Country')
p2
```

# Applications
* Estimate the amount of inputs required to increase pH to a certain level.
* With data on limestone production locations, we can estimate the cost of taking it to the farms,
* Make an analysis of prioritization of areas to increase yields.
